<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–±–æ—Ä–æ–º –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞–≤–æ–∫</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-8 text-center">
            <i class="fas fa-chart-line mr-3"></i>
            –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–±–æ—Ä–æ–º –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞–≤–æ–∫
        </h1>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="bg-gray-800 rounded-lg p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">
                <i class="fas fa-chart-bar mr-2"></i>
                –¢–µ–∫—É—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            </h2>
            <div id="stats-content" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-gray-700 p-4 rounded">
                    <div class="text-2xl font-bold text-blue-400" id="total-lots">-</div>
                    <div class="text-sm text-gray-300">–í—Å–µ–≥–æ –ª–æ—Ç–æ–≤</div>
                </div>
                <div class="bg-gray-700 p-4 rounded">
                    <div class="text-2xl font-bold text-green-400" id="with-history">-</div>
                    <div class="text-sm text-gray-300">–° –∏—Å—Ç–æ—Ä–∏–µ–π —Å—Ç–∞–≤–æ–∫</div>
                </div>
                <div class="bg-gray-700 p-4 rounded">
                    <div class="text-2xl font-bold text-red-400" id="without-history">-</div>
                    <div class="text-sm text-gray-300">–ë–µ–∑ –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞–≤–æ–∫</div>
                </div>
            </div>
            <button onclick="loadStats()" class="mt-4 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
                <i class="fas fa-sync-alt mr-2"></i>–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            </button>
        </div>

        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–±–æ—Ä–æ–º -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- –°–±–æ—Ä –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ª–æ—Ç–æ–≤ -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">
                    <i class="fas fa-database mr-2"></i>
                    –°–±–æ—Ä –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ª–æ—Ç–æ–≤
                </h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">–†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞:</label>
                        <input type="number" id="batch-size" value="50" min="1" max="200" 
                               class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">–ú–∞–∫—Å–∏–º—É–º –ª–æ—Ç–æ–≤:</label>
                        <input type="number" id="max-lots" value="1000" min="1" max="10000" 
                               class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                    </div>
                    <button onclick="startExistingCollection()" 
                            class="w-full bg-green-600 hover:bg-green-700 px-4 py-2 rounded">
                        <i class="fas fa-play mr-2"></i>–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–±–æ—Ä
                    </button>
                </div>
            </div>

            <!-- –ü–∞—Ä—Å–∏–Ω–≥ –Ω–æ–≤—ã—Ö –ª–æ—Ç–æ–≤ -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">
                    <i class="fas fa-plus-circle mr-2"></i>
                    –ü–∞—Ä—Å–∏–Ω–≥ –Ω–æ–≤—ã—Ö –ª–æ—Ç–æ–≤
                </h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">–ù–æ–º–µ—Ä –∞—É–∫—Ü–∏–æ–Ω–∞:</label>
                        <input type="text" id="auction-number" placeholder="2134" 
                               class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                    </div>
                    <button onclick="startNewLotParsing()" 
                            class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
                        <i class="fas fa-download mr-2"></i>–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥
                    </button>
                </div>
            </div>
        </div>

        <!-- –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ä–µ–∂–∏–º -->
        <div class="bg-gray-800 rounded-lg p-6 mt-6">
            <h3 class="text-lg font-semibold mb-4">
                <i class="fas fa-cogs mr-2"></i>
                –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ä–µ–∂–∏–º
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-2">–†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞:</label>
                    <input type="number" id="comp-batch-size" value="50" min="1" max="200" 
                           class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">–ú–∞–∫—Å–∏–º—É–º –ª–æ—Ç–æ–≤:</label>
                    <input type="number" id="comp-max-lots" value="1000" min="1" max="10000" 
                           class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">–ù–æ–º–µ—Ä –∞—É–∫—Ü–∏–æ–Ω–∞:</label>
                    <input type="text" id="comp-auction-number" placeholder="2134" 
                           class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                </div>
            </div>
            <button onclick="startComprehensiveCollection()" 
                    class="mt-4 w-full bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded">
                <i class="fas fa-rocket mr-2"></i>–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Å–±–æ—Ä
            </button>
        </div>

        <!-- –õ–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è -->
        <div class="bg-gray-800 rounded-lg p-6 mt-6">
            <h3 class="text-lg font-semibold mb-4">
                <i class="fas fa-terminal mr-2"></i>
                –õ–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
            </h3>
            <div id="logs" class="bg-black text-green-400 p-4 rounded font-mono text-sm h-64 overflow-y-auto">
                <div class="text-gray-500">–õ–æ–≥–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π...</div>
            </div>
            <button onclick="clearLogs()" class="mt-4 bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded">
                <i class="fas fa-trash mr-2"></i>–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
            </button>
        </div>
    </div>

    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function loadStats() {
            try {
                const response = await fetch('/api/admin/bidding-stats');
                const stats = await response.json();
                
                document.getElementById('total-lots').textContent = stats.total_lots || 0;
                document.getElementById('with-history').textContent = stats.with_bidding_history || 0;
                document.getElementById('without-history').textContent = stats.without_bidding_history || 0;
                
                addLog('‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
            } catch (error) {
                addLog('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ' + error.message);
            }
        }

        // –ó–∞–ø—É—Å–∫ —Å–±–æ—Ä–∞ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ª–æ—Ç–æ–≤
        async function startExistingCollection() {
            const batchSize = document.getElementById('batch-size').value;
            const maxLots = document.getElementById('max-lots').value;
            
            addLog(`üöÄ –ó–∞–ø—É—Å–∫ —Å–±–æ—Ä–∞ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ª–æ—Ç–æ–≤ (batch=${batchSize}, max=${maxLots})`);
            
            try {
                const response = await fetch('/api/admin/start-existing-collection', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ batchSize: parseInt(batchSize), maxLots: parseInt(maxLots) })
                });
                
                const result = await response.json();
                addLog(`‚úÖ –°–±–æ—Ä –∑–∞–ø—É—â–µ–Ω: ${JSON.stringify(result)}`);
            } catch (error) {
                addLog('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Å–±–æ—Ä–∞: ' + error.message);
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ –Ω–æ–≤—ã—Ö –ª–æ—Ç–æ–≤
        async function startNewLotParsing() {
            const auctionNumber = document.getElementById('auction-number').value;
            
            if (!auctionNumber) {
                addLog('‚ùå –£–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä –∞—É–∫—Ü–∏–æ–Ω–∞');
                return;
            }
            
            addLog(`üöÄ –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ –Ω–æ–≤—ã—Ö –ª–æ—Ç–æ–≤ (–∞—É–∫—Ü–∏–æ–Ω ${auctionNumber})`);
            
            try {
                const response = await fetch('/api/admin/start-new-parsing', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ auctionNumber })
                });
                
                const result = await response.json();
                addLog(`‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω: ${JSON.stringify(result)}`);
            } catch (error) {
                addLog('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞: ' + error.message);
            }
        }

        // –ó–∞–ø—É—Å–∫ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —Å–±–æ—Ä–∞
        async function startComprehensiveCollection() {
            const batchSize = document.getElementById('comp-batch-size').value;
            const maxLots = document.getElementById('comp-max-lots').value;
            const auctionNumber = document.getElementById('comp-auction-number').value;
            
            addLog(`üöÄ –ó–∞–ø—É—Å–∫ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —Å–±–æ—Ä–∞ (batch=${batchSize}, max=${maxLots}, auction=${auctionNumber})`);
            
            try {
                const response = await fetch('/api/admin/start-comprehensive-collection', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        batchSize: parseInt(batchSize), 
                        maxLots: parseInt(maxLots),
                        auctionNumber 
                    })
                });
                
                const result = await response.json();
                addLog(`‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Å–±–æ—Ä –∑–∞–ø—É—â–µ–Ω: ${JSON.stringify(result)}`);
            } catch (error) {
                addLog('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —Å–±–æ—Ä–∞: ' + error.message);
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∞
        function addLog(message) {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logs.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            logs.scrollTop = logs.scrollHeight;
        }

        // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤
        function clearLogs() {
            document.getElementById('logs').innerHTML = '<div class="text-gray-500">–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã...</div>';
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            loadStats();
        };
    </script>
</body>
</html>
