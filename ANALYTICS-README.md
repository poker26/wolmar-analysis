# Analytics Service - –ê–Ω–∞–ª–∏–∑ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫

–û—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∞ –∞—É–∫—Ü–∏–æ–Ω–∞—Ö Wolmar.

## üöÄ –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install --package-lock-only analytics-package.json

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev

# –ò–ª–∏ –æ–±—ã—á–Ω—ã–π –∑–∞–ø—É—Å–∫
npm start
```

### –ü—Ä–æ–¥–∞–∫—à–Ω —Å PM2
```bash
# –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ PM2
npm run pm2:start

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
npm run pm2:stop

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
npm run pm2:restart

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
npm run pm2:logs
```

## üìä –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### API Endpoints

1. **`GET /api/analytics/dashboard-stats`** - –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞
2. **`GET /api/analytics/fast-manual-bids`** - –ê–Ω–∞–ª–∏–∑ –±—ã—Å—Ç—Ä—ã—Ö —Ä—É—á–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫
3. **`GET /api/analytics/autobid-traps`** - –ê–Ω–∞–ª–∏–∑ –ª–æ–≤—É—à–µ–∫ –∞–≤—Ç–æ–±–∏–¥–∞
4. **`GET /api/analytics/time-patterns`** - –ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
5. **`GET /api/analytics/bid-ratios`** - –ê–Ω–∞–ª–∏–∑ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å—Ç–∞–≤–æ–∫
6. **`GET /api/analytics/bidder-conflicts`** - –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å—Ç–∞–≤—â–∏–∫–æ–≤
7. **`GET /api/analytics/suspicious-scoring`** - –°–∫–æ—Ä–∏–Ω–≥ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

- **URL**: `http://localhost:3002/analytics`
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π responsive –¥–∏–∑–∞–π–Ω
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- –°–∏—Å—Ç–µ–º–∞ —Å–∫–æ—Ä–∏–Ω–≥–∞ —Ä–∏—Å–∫–æ–≤
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
ANALYTICS_PORT=3002
DATABASE_URL=postgresql://user:password@localhost:5432/wolmar_parser
NODE_ENV=production
```

### Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–î–æ–±–∞–≤–∏—Ç—å –≤ nginx.conf:
```nginx
location /analytics/ {
    proxy_pass http://localhost:3002/;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_cache_bypass $http_upgrade;
}
```

## üìà –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

### 1. –ë—ã—Å—Ç—Ä—ã–µ —Ä—É—á–Ω—ã–µ —Å—Ç–∞–≤–∫–∏
- –°—Ç–∞–≤–∫–∏ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º < 5 —Å–µ–∫—É–Ω–¥
- –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ –±—ã—Å—Ç—Ä—ã–µ —Ä–µ–∞–∫—Ü–∏–∏
- –í–æ–∑–º–æ–∂–Ω—ã–µ –±–æ—Ç—ã

### 2. –õ–æ–≤—É—à–∫–∏ –∞–≤—Ç–æ–±–∏–¥–∞
- –†—É—á–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ = —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞
- –†—É—á–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ = —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ - 1
- –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å

### 3. –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- –ù–æ—á–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ (22:00-06:00)
- –°—Ç–∞–≤–∫–∏ –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ
- –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã

### 4. –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å—Ç–∞–≤–æ–∫
- –í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç —Ä—É—á–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫ (>80%)
- –ê–Ω–æ–º–∞–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–±–∏–¥–∞

### 5. –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å—Ç–∞–≤—â–∏–∫–æ–≤
- –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –ø–µ—Ä–µ–±–∏–≤–∞–Ω–∏—è –º–µ–∂–¥—É –¥–≤—É–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ "–≤–æ–π–Ω—ã —Å—Ç–∞–≤–æ–∫"

### 6. –°–∫–æ—Ä–∏–Ω–≥ —Ä–∏—Å–∫–æ–≤
- –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –£—Ä–æ–≤–Ω–∏ —Ä–∏—Å–∫–∞: –ù–ò–ó–ö–ò–ô, –°–†–ï–î–ù–ò–ô, –í–´–°–û–ö–ò–ô

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –û—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç
- CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- Graceful shutdown –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–µ—Ä–≤–∏—Å –ª–æ–≥–∏—Ä—É–µ—Ç:
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- –û—à–∏–±–∫–∏ API
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–°–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
- –û—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ—Ä—Ç (3002)
- –û—Ç–¥–µ–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—Ç–∞ –∂–µ, —á—Ç–æ –∏ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
- –û—Ç–¥–µ–ª—å–Ω—ã–µ –ª–æ–≥–∏ PM2
- –û—Ç–¥–µ–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx

## üö® –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
```bash
# –°—Ç–∞—Ç—É—Å PM2
pm2 status analytics-service

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
pm2 logs analytics-service --lines 100

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
pm2 monit
```
