#!/bin/bash

echo "üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê 502 BAD GATEWAY"
echo "================================"

echo ""
echo "1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å PM2 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:"
pm2 status

echo ""
echo "2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ PM2:"
echo "--- –ü–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤ wolmar-server ---"
pm2 logs wolmar-server --lines 20

echo ""
echo "3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–ª—É—à–∞–µ—Ç –ª–∏ Node.js –Ω–∞ –ø–æ—Ä—Ç—É 3001:"
netstat -tlnp | grep :3001

echo ""
echo "4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å Nginx:"
systemctl status nginx --no-pager -l

echo ""
echo "5Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx:"
nginx -t

echo ""
echo "6Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ Nginx:"
echo "--- –ü–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å—Ç—Ä–æ–∫ error.log ---"
tail -20 /var/log/nginx/error.log

echo ""
echo "7Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Node.js –Ω–∞–ø—Ä—è–º—É—é:"
curl -I http://localhost:3001/ || echo "‚ùå Node.js –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ localhost:3001"

echo ""
echo "8Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ Nginx:"
curl -I http://localhost/ || echo "‚ùå Nginx –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

echo ""
echo "9Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –∏ CPU:"
free -h
echo "CPU load:"
uptime

echo ""
echo "üîü –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:"
ss -tuln | grep -E ':(80|443|3001)'

echo ""
echo "‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
